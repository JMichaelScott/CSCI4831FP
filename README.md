# CSCI4831FP
Computer Science 4831 - Sabermetrics - Final Project

## TrueSkill Implementation – Baseball
	Baseball has an enormous amount of data, but very little information. The statistics that can be easily calculated, such as slugging percentage, give only a partial picture of a player’s contribution to the team’s performance. More complex statistics, such as Wins About Replacement (WAR) can only be calculated with years of prior data and extremely complex calculations. According to FanGraphs, “WAR is an attempt … to summarize a player’s total contributions to their team in one statistic,” (1). Despite all of this work by sabermetrics practitioners, it is still difficult to consolidate a player’s performance and rank player by skill. This is a gap that the TrueSkill system by Microsoft Research can help to address.
	TrueSkill was created for Microsoft’s Xbox Live service to address shortcomings in the Elo ranking system used by Chess and similar systems. Elo is only able to evaluate the performance of two players and requires many ranked games before a player’s score can stabilize. TrueSkill uses a probability distribution of a player’s performance to encompass their average skill (mean) and uncertainty of their performance (standard deviation). As a player plays more games, the uncertainty around their average skill will decrease until their expected performance has been mapped effectively (2, 3). The advantage of this approach is that the TrueSkill algorithm can rapidly converge to a belief of a player’s skill, can track team performance, and allows for partial participation in games (4, 5). 
  TrueSkill mitigates the data requirements of WAR, but is mathematically very complex. Jeff Moser begins both his blog post and paper on TrueSkill with a primer on probability in general and Gaussian distributions in specific (5, 6). His “The Math Behind TrueSkill” paper has derivations that are literally pages long to explain the intricacies of TrueSkill’s calculations (this should have been a warning sign for me). The algorithm uses factor graphs which are bipartite directed graphs consisting of factors and variables. Factors are Gaussian probability distributions and variables are observations of player behavior. The factor graph uses a player’s expected performance (the prior) and predicts the likelihood of a player’s actual performance, then the team’s performance, to estimate the outcome of the game (6). The actual outcome is then propagated back to the player level as an adjustment to their skill probability distribution. 
  It would have been literally impossible to write a single line of code for this project without Jeff Moser’s C# implementation (7). Unfortunately, I do not know C#. I initially attempted to learn C# in order to use the code but the distance between where I started and where I needed to be was too great to traverse in the time I had allowed to work on the project. I then attempted to re-implement his code in Python, but with dozens of classes, C# interactions that I had to guess at, and extremely complex math, I was unable to fully do so. It took a significant amount of time to understand the C# code and map it to the math. It was also difficult to understand the connections between the various classes and required a lot of back tracking once connections were clear. It would have been an excellent idea to map out the interactions on a whiteboard as they became clear. 
  Given my inability to implement the algorithm, I can discuss my intentions for implementation. Baseball has several stats that are relatively easy to calculate and can concretely measure a player’s contribution to a game’s output. As only scoring affects the outcome of a game, offensively only statistics that measure score impact (RBI, Slugging, and bases on balls) would be included for performance, and defensively only statistics that prevent scoring would be measured (a positive equivalent to ERA – tracking strikes and penalizing for hits and balls, putouts and assists). Partial play would only occur if a player had to leave the game for any reason. These stats would allow for rankings of player contribution to their team overall during a specific game. Defensively and offensively, each player would be counted as a separate offensive player and defensive player who’s prior and likelihood of performance is calculated separately. The offensive and defensive “players” would be combined into the actual player, and all the actual players would be combined into teams.
  To test the model’s suitability for baseball, I would use the 2010 Restrosheet data. I pulled all the data for that year, so it would be simple to iterate if I needed to include additional statistics for the model. Calculating the stats listed in the previous paragraph by player and game is relatively easy using Python’s Pandas library. I would then capture how quickly standard deviations converged on a player’s mean skill. If the standard deviations collapsed relatively quickly, and game predictions were relatively consistent with reality I would consider the model a success. Implementing the model in Python would have allowed me to track down where the model’s predictions were falling down and begin to tinker with either inputs or the factor graph.
  Despite being unable to implement the algorithm in full, I believe it’s a promising start for evaluation. The math and the code are not insurmountably difficult, but would require dedicating significant amounts of time to making sure that the implementation is correct. Microsoft Research also recently published TrueSkill 2, which may be a better fit for analyzing baseball (8). I do plan on continuing this project as there are a number of practical applications for developing TrueSkill in the hobby gaming community and it’s an interesting problem. I will (and should have originally) investigate  if there any python libraries that can simplify implementing a factor graph.
	


1.	FanGraphs. What is WAR? [Online] May 2018. https://www.fangraphs.com/library/misc/war/
2.	Minka, Tom and Zaykov, Yordan. TrueSkill Ranking System. [Online] May 2018. http://research.microsoft.com/en-us/projects/trueskill/calculators.aspx
3.	Graepel, Thore, Herbrich, Ralph, and Minka, Tom. TrueSkill: A Bayesian Skill Rating System. [Online] January 1, 2007. https://www.microsoft.com/en-us/research/wp-content/uploads/2007/01/NIPS2006_0688.pdf
4.	Graepel, Thore, Herbrich, Ralph, and Minka, Tom. TrueSkill: A Bayesian Skill Rating System. [Online] January 1, 2007. https://www.microsoft.com/en-us/research/wp-content/uploads/2007/01/NIPS2006_0688.pdf
5.	Moser, Jeff. Computing Your Skill. [Online] March 18, 2010. http://www.moserware.com/2010/03/computing-your-skill.html
6.	Moser, Jeff. The Math Behind TrueSkill. [Online] May 28, 2011. http://www.moserware.com/assets/computing-your-skill/The%20Math%20Behind%20TrueSkill.pdf
7.	Moser, Jeff. Moserware.Skills. [Online] July 9, 2013. http://github.com/moserware/Skills
8.	Cleven, Ryan, Minka, Tom and Zaykov Yordan. TrueSkill 2: An Improved Bayesian skill rating system. [Online] March 22, 2018. https://www.microsoft.com/en-us/research/uploads/prod/2018/03/trueskill2.pdf
